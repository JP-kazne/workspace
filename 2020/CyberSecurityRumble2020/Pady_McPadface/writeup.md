Not solved :(

# Try

```bash
$ nc chal.cybersecurityrumble.de 34187 > output.txt
```

コマンドを実行すると以下の出力が得られる。（数字は省略）

```py
#!/usr/bin/env python3
from random import SystemRandom
from config import p,q,e,flag

print("="*50)
print(open(__file__).read())
print("~"*50)

random = SystemRandom()

flag = int.from_bytes(flag,"big")

n = p*q
assert(p<q<2*p)

print(f"{n=}")
print(f"{e=}")

def pad(m):
    assert(m<2**128)
    r = random.randrange(2**(p.bit_length()-65))
    return m+r**2

def encrypt(m):
    return pow(pad(m), e, n)

for i in bin(flag)[2:]:
    print(encrypt(int(i)))

```

```
n=23946008544227658126007712372803958643232141489757386834260550742271224503035086875887914418064683964046938371640632153677880813529023769841157840969433316734058706481517878257755290676559343682013294580085557476138201639446709290119631383493940405818550255561589074538261117055296294434994144540224412018398452371792093095280080422459773487177339595746894989682038387107119249733105558301840478252766907821053044992141741079156669562032221433390029219634673005161989684970682781410366155504440886376453225497112165607897302209008685179791558898003720802478389914297472563728836647547791799771532020349546729665006643
e=65537
11476768266916164235309881869651940983984675977351051488298450585131110601361259097767182157590949077850278997957210418057571307999354160029914789797303064257673407678466176588055141285504559106147929534411017329460235914731370943844688796504720758193546976717119126655806126593345950791534301821557903985493736264684395251936150675286740482526539878961217409934905048447539295655562679224968766009669108468927568770130096114644357525215815012691791276538573769506001550741827885315948422392251512744224078755783499979105637675307490022506657625779496937616765280504522638229224345078966894708384126926174077244882975
6344781982406291229904616097805576891680892322322233659332047813051271052109897033252412538927719488412069758369450241995502516459491473242999017770856786045082580123686511514697479818998491222910687788991281589873507596649734736831753657844561650803919893634314315967644310123683825013046295631859453549892078522986400756535163909207475879084021071358300550008249888124344976827483625126703181222101427358253757725725111508077062593842303282441855876873129588295014017202563048619388174412323763633870647195416100738355366319758548648612458199676439286...
```

* $n$ はおよそ $2^{2048}$ くらいで、$p < q < 2*p$ なので $p,q$ もおよそ $2^{1024}$ くらいである

* $i$ はバイナリの要素なので $0$ か $1$ である

$c$ が $(r^2)^e \mod n$ と $(1+r^2)^e \mod n$ のどちらかなのか見分けられれば良いと思ったが、方法が思いつかなかった。

# Solution

**[Writeup]**

* https://ctftime.org/writeup/24770

$(r^2)^e = (r^e)^2 \equiv c \mod n$ と変形し、$c$ が $n$ を法とする**平方剰余**であるかを調べればよい。

> **平方剰余**
> 整数 $q$ が $N$ を法として平方数に合同であるとき、 $q$ は $N$ を法とする平方剰余という。
>
> $_{}^{\exists}x$ s.t. $x^2 \equiv q \mod N$
> $\Leftrightarrow$ $q$ : $N$ を法とする平方剰余

$q$ が $N$ の平方剰余かどうかを次の記号を使って表す。

> **ルジャンドル記号**
> $(\frac{q}{N})=\begin{cases}
1 & (qがNの平方剰余である)\\ 
-1 & (qがNの平方剰余でない)
\end{cases}$

また、以下の法則が成り立つ。(証明略)

> 異なる奇素数 $p,q$ に対して、
> * $(\frac{q}{p})(\frac{p}{q}) = (-1)^{\frac{p-1}{2}\cdot\frac{q-1}{2}}$
>
> 奇素数 $p$ に対して、
> * $(\frac{-1}{p}) = (-1)^{\frac{p-1}{2}}$
> * $(\frac{2}{p}) = (-1)^{\frac{p^2-1}{8}}$
>
> $a,b$ が $p$ と互いに素なとき
> * $(\frac{ab}{p}) = (\frac{a}{p})(\frac{b}{p})$

[定理の説明]

* https://mathtrain.jp/sogohosoku

[プログラム+解説]

* https://tex2e.github.io/blog/crypto/legendre-and-jacobi-symbls

