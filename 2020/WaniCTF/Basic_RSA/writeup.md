# Writeup

`nc rsa.wanictf.org 50000` を実行。

**[第1段階]**

```bash
$ nc rsa.wanictf.org 50000

:::::::..   .::::::.   :::.
;;;;``;;;; ;;;`    `   ;;`;;
 [[[,/[[[' '[==/[[[[, ,[[ '[[,
 $$$$$$c     '''    $c$$$cc$$$c
 888b "88bo,88b    dP 888   888,
 MMMM   "W"  "YMmMY"  YMM   ""`


+================================+
| Given : p, q (512-bit integer) |
| Find  : n = p*q                |
+================================+

p = 4135412297931592169274029369143055253902894199108706463075628760224426486382785176814235505920877073721287967664361469432766630728311036001951138916803091
q = 1270191851818290566130488475019640166455186000626449243197016383582235344341219619223457286546254181668993473054631861665518376727649776111143744519272622
[n?] >
```

`p,q`が与えられるので`n=p*q`を計算する。

**[第2段階]**

```bash
+=======================================+
| Given : m ) Message                   |
|         e ) Public exponent           |
|         n ) p*q  (p, q 512-bit prime) |
| Find  : c = m**e (mod n)              |
+=======================================+

m = 17767495911267545777227879678834852179
e = 65537
n = 120972380205166506252109286312074977835879034160227754395918415748967769670091899529334907390105497762815972801484361577645832606544635097294962229322364156920388701231359224269063184869640782269970060208492419787050280336406939473175340557568219736465686292950830795287001322539785890235810443425831424922797
[c?] >
```

`m,e,n`が与えられるので`c=m**e (mod n)`を計算する。

**[第3段階]**

```bash
+=====================================+
| Given :  p, q ) 512-bit primes      |
|          e    ) Public exponent     |
|          c    ) Encrypted message   |
|                 = m**e (mod p*q)    |
| Find  :  m    ) Message             |
+=====================================+

p = 12715517992930005153221533743266424793279321489116127638250099527439623685930195848480800414042156386978460769420497920564852591366387057528935922110907469
q = 12315099225438748066111902076946131465224680028266812454748120647977730833183650670845298977938842477092891995745165896767496770521986627731816858065516319
e = 65537
c = 2421874335363931083113032857107996193620209877760367875666849841112088588197839346205500295855370965417254899824586713213330296029052047643201569984294866533031509086978555439756682520822396873345249440931874205416553529652063294810757764641527002013107851484879111874851837003007342269008872250876617958784
[m?] >
```

`p,q,e,c`が与えられるので`m`を求める。

`c = m**e (mod p*q)`なので、

`d = e**(-1) (mod (p-1)(q-1)),`

`m = c**d (mod p*q)`

となる。

以下のプログラムを実行し、フラグを取得。

```py
from pwn import *
from Crypto.Util.number import inverse

conn = remote('rsa.wanictf.org',50000)

# 第1段階
conn.recvuntil('p = ')
p = int(conn.recvline())
conn.recvuntil('q = ')
q = int(conn.recvline())
n = p * q
conn.sendline(str(n))

# 第2段階
conn.recvuntil('m = ')
m = int(conn.recvline())
conn.recvuntil('e = ')
e = int(conn.recvline())
conn.recvuntil('n = ')
n = int(conn.recvline())
c = pow(m,e,n)
conn.sendline(str(c))

# 第3段階
conn.recvuntil('p = ')
p = int(conn.recvline())
conn.recvuntil('q = ')
q = int(conn.recvline())
conn.recvuntil('e = ')
e = int(conn.recvline())
conn.recvuntil('c = ')
c = int(conn.recvline())
d = inverse(e,(p-1)*(q-1))
m = pow(c,d,p*q)
conn.sendline(str(m))

# フラグ出力
print(conn.recvline())
conn.close()
```

<!-- FLAG{y0uv3_und3rst00d_t3xtb00k_RSA} -->